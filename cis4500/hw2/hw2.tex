\documentclass[12pt,letterpaper, onecolumn]{exam}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{color}
\usepackage{listings}
\usepackage[dvipsnames]{xcolor}
\graphicspath{ {./images/} }
\lhead{Mustafa Rashid\\}
\rhead{Homework 2: Relational DB Design\\}
\chead{\hline} 
\thispagestyle{empty} 
\newcommand*{\setdef}[1]{\left\{#1 \right\}} 
\renewcommand{\thepartno}{\Alph{partno}} % Force uppercase letters
\renewcommand{\partlabel}{\thepartno.}    % Format as A. B. C.

\begin{document}
\begingroup  
\noindent\LARGE CIS 5500: Database and Information Systems\\
\noindent\LARGE Homework 2: Relational DB Design\\
\noindent\large \today\\
\noindent\large Mustafa Rashid\par
\noindent\large Spring 2026\par
\endgroup
\rule{\textwidth}{0.4pt}
\pointsdroppedatright
\printanswers
\renewcommand{\solutiontitle}{\noindent\textbf{Ans:}\enspace}

% SQL listing from https://gist.githubusercontent.com/vivngo/e37e1c7b79bf7e8b910c6566c59c46be/raw/db8723fc80c8b1b01665851106dba2f370b5d865/code.tex
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\lstset{language=SQL,
  basicstyle={\small\ttfamily},
  belowskip=3mm,
  breakatwhitespace=true,
  breaklines=true,
  classoffset=0,
  columns=flexible,
  commentstyle=\color{dkgreen},
  framexleftmargin=0.25em,
  frameshape={}{}{}{}, %To remove to vertical lines on left, set `frameshape={}{}{}{}`
  keywordstyle=\color{blue},
  numbers=none, %If you want line numbers, set `numbers=left`
  numberstyle=\tiny\color{gray},
  showstringspaces=false,
  stringstyle=\color{mauve},
  tabsize=3,
  xleftmargin =1em
}

\begin{questions}
  \question \textbf{Question 1 (30 points)}
  \begin{parts}
    \part \textbf{(20 points)}
     \begin{center}
       \includegraphics[scale=0.25]{hw2_q1.png}
     \end{center}
    \part \textbf{(5 points)}
\begin{solution}
A TravelSegment could start or end at a Station that is not served by its associated TransportLine. 
This would be valid in the ER diagram because there is no constraint requiring the start and end 
stations of a TravelSegment to be among the stations served by that TransportLine.

To enforce this constraint, we must require that the start and end stations of a TravelSegment 
appear in the Serves relationship with the same TransportLine. In other words, a TravelSegment 
may only start and end at stations that are served by its associated TransportLine.
\end{solution}
    \part \textbf{(5 points)}
\begin{solution}
Add an attribute to the relationship \texttt{Serves} called \texttt{no\_of\_platforms}. 
Add an attribute to the Station entity set called \texttt{maximum\_no\_of\_platforms}. 

We then add a constraint that, for each Station, the sum of \texttt{no\_of\_platforms} 
across all TransportLines assigned to that Station does not exceed\\
\texttt{maximum\_no\_of\_platforms}.
\end{solution}
  \end{parts}

  \pagebreak

  \question \textbf{Question 2 (20 points)}\begin{parts}
    \part \textbf{12 points}
    \begin{solution}\\
      \begin{lstlisting}
        CREATE TABLE Artists(
        ArtistID INT PRIMARY KEY,
        Name VARCHAR(50) NOT NULL,
        Nationality VARCHAR(50) NOT NULL,
        BirthYear INT(4) NOT NULL
        );

        CREATE TABLE Customers(
        CustomerID INT PRIMARY KEY,
        Name VARCHAR(50) NOT NULL,
        Email VARCHAR(100) NOT NULL
        );

        CREATE TABLE Artworks(
        ArtworkID INT PRIMARY KEY,
        OwnerID INT FOREIGN KEY REFERENCES Customers(CustomerID),
        CreatorID INT FOREIGN KEY REFERENCES Artists(ArtistID),
        Title VARCHAR(50) NOT NULL,
        AYear INT(4),
        Medium VARCHAR(50)
        );

        CREATE TABLE Exhibitions(
        ExhibitionID INT PRIMARY KEY,
        ExhibitionName VARCHAR(100) NOT NULL
        );

        CREATE TABLE DisplayedIn(
        ArtworkID INT,
        ExhibitionID INT,
        PRIMARY KEY (ArtworkID, ExhibitionID),
        FOREIGN KEY (ArtworkID) REFERENCES Artworks(ArtworkID),
        FOREIGN KEY (ExhibitionID) REFERENCES Exhibitions(ExhibitionID),
        StartDate DATE,
        EndDate DATE
        );
      \end{lstlisting}
    \end{solution}
    \pagebreak
    \part \textbf{4 points}
    \begin{solution}
      We can create an assertion as follows
      \begin{lstlisting}
        CREATE ASSERTION exhibition_cardinality
CHECK (
    NOT EXISTS (
        SELECT ExhibitionID
        FROM DisplayedIn
        GROUP BY ExhibitionID
        HAVING COUNT(*) NOT BETWEEN 5 AND 20
    )
);
\end{lstlisting}
    \end{solution}
    \part \textbf{4 points}
    \begin{solution}
      We change the cardinality on the Artists entity set from \(0..*\) to \(1..*\). We also add the following assertion
      \begin{lstlisting}
CREATE ASSERTION artist_has_artwork
CHECK (
  NOT EXISTS (
    SELECT *
    FROM Artists A
    WHERE NOT EXISTS (
      SELECT *
      FROM Artworks W
      WHERE W.CreatorID = A.ArtistID
    )
  )
);
\end{lstlisting}
    \end{solution}
  \end{parts}
  \pagebreak
  \question \textbf{Question 3 (40 points)}\begin{parts}
    \part \textbf{4 points}
    \begin{solution}
      No they cannot.\\If they did then the functional dependencies PassengerID \(\rightarrow\) PassengerEmail and PassengerEmail \(\rightarrow\) PassengerID would not hold.
    \end{solution}
    \part \textbf{4 points}
    \begin{solution}
Yes. The functional dependency TrainNo \(\rightarrow\) ConductorID only ensures each train has one conductor, but it does not prevent multiple trains from having the same conductor.
\end{solution}
    \part \textbf{6 points}
    \begin{solution}
      The candidate keys are \{TrainNo, PassengerID\} and \{TrainNo, PassengerEmail\}. 
TrainNo determines DepartureDate and ConductorID, PassengerID determines PassengerEmail, and together TrainNo and PassengerID determine SeatNo and BaggageQty, giving all attributes. Since PassengerEmail \(\leftrightarrow\) PassengerID, replacing PassengerID with PassengerEmail also forms a key.
\end{solution}
    \part \textbf{5 points}
    \begin{solution}
The dependency TrainNo \(\rightarrow\) DepartureDate, ConductorID violates 3NF because TrainNo is not a superkey 
and neither DepartureDate nor ConductorID is a member of any candidate key. 
All other dependencies satisfy 3NF because either the left-hand side is a superkey or 
the right-hand side attribute is a member of some candidate key.
\end{solution}
    \part \textbf{2 points}
\begin{solution}
  Yes, the decomposition has a lossless join. \begin{center}\(R_1 \cap R_2 =\) \{TrainNo, PassengerID\},\end{center} which is a candidate key of $R$ and therefore a superkey of $R_2$. By the lossless-join condition, a decomposition is lossless if the common attributes form a superkey of at least one of the relations, so the join is lossless.
\end{solution}
\pagebreak
\part \textbf{2 points}
\begin{solution}
  No, this decomposition does not have a lossless join. \begin{center}\(R_1 \cap R_2 =\) \{PassengerID\},\end{center} which is neither a superkey of \(R_1\) nor of \(R_2\) (PassengerID alone does not determine DepartureDate or ConductorID, nor SeatNo or BaggageQty), so the lossless-join condition fails. 
\end{solution}
\part \textbf{12 points}
\begin{solution}
Applying the 3NF decomposition algorithm to $F$ (already a minimal cover):
\begin{itemize}
    \item $\texttt{TrainNo} \to \texttt{DepartureDate, ConductorID}$: create $R_1$
    \item $\texttt{PassengerID} \to \texttt{PassengerEmail}$: create $R_2$
    \item $\texttt{PassengerEmail} \to \texttt{PassengerID}$: $R_2$ already contains \texttt{PassengerEmail, PassengerID} so we skip this functional dependency
    \item $\texttt{TrainNo, PassengerID} \to \texttt{SeatNo, BaggageQty}$: create $R_3$
\end{itemize}

\noindent $R_3$ contains \{\texttt{TrainNo, PassengerID}\}, a candidate key of $R$ meaning that we do not need any additional relations.
\begin{itemize}

  After performing the algorithm we get the following decomposed relations \(R_i\) each with with a candidate key and a set of preserved functional dependencies.
    \item $R_1$(\texttt{TrainNo}, \texttt{DepartureDate}, \texttt{ConductorID})
    \begin{itemize}
        \item \textbf{Candidate Key:} \{\texttt{TrainNo}\}
        \item \textbf{FDs Preserved:} $\texttt{TrainNo} \to \texttt{DepartureDate, ConductorID}$
    \end{itemize}

    \item $R_2$({\texttt{PassengerID}, \texttt{PassengerEmail})
    \begin{itemize}
        \item \textbf{Candidate Keys:} \{\texttt{PassengerID}\}, \{\texttt{PassengerEmail}\}
        \item \textbf{FDs Preserved:} $\texttt{PassengerID} \leftrightarrow \texttt{PassengerEmail}$
    \end{itemize}

  \item $R_3$(\texttt{TrainNo}, \texttt{PassengerID}, \texttt{SeatNo}, \texttt{BaggageQty})
    \begin{itemize}
        \item \textbf{Candidate Key:} \{\texttt{TrainNo, PassengerID}\}
        \item \textbf{FDs Preserved:} $\texttt{TrainNo, PassengerID} \to \texttt{SeatNo, BaggageQty}$
    \end{itemize}
\end{itemize}
\end{solution}
\pagebreak
\part \textbf{5 points}
\begin{solution}

Yes, all three relations are in BCNF. For every \(X \to Y\) in \(F\), either \(X \to Y\) is trivial or \(X\) is a superkey:

\begin{itemize}
  \item $R_1$(\texttt{TrainNo}, \texttt{DepartureDate}, \texttt{ConductorID}) with key \texttt{TrainNo}. \\\texttt{TrainNo \(\to\) DepartureDate} and \texttt{TrainNo}\(\to\)\texttt{ConductorID} have \texttt{TrainNo} as LHS, which is a superkey. 
  \item $R_2$({\texttt{PassengerID}, \texttt{PassengerEmail}) with keys\\  \texttt{PassengerID, PassengerEmail}. \texttt{PassengerID} \(\to\) \texttt{PassengerEmail} has superkey LHS, and\\ \texttt{PassengerEmail}\(\to\)\texttt{PassengerID} has superkey LHS. 
    \item $R_3$(\texttt{TrainNo}, \texttt{PassengerID}, \texttt{SeatNo}, \texttt{BaggageQty}) with key = \texttt{TrainNo, PassengerID}. Both \texttt{TrainNo, PassengerID} \(\to\) \texttt{SeatNo} and\\ \texttt{TrainNo, PassengerID} \(\to\) \texttt{BaggageQty} have the full key as LHS. 
\end{itemize}
\end{solution}
  \end{parts}
\end{questions}
\end{document}
